---
title: "Behavioural Data Playmore EEG"
author: "Marta Topor"
date: "8/10/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE)
```

```{r data_setup}
setwd("I:/SCIENCE-NEXS-neurolab/PROJECTS/PLAYMORE/EEG_project1/Analyses")
library(tidyverse)
library(knitr)
library(yarrr)
library(jmv)

Sys.setenv(lang = "en_UK")

#read all data
df <- read.csv('all_subjects.csv')

#select those who meet inclusion critera
df_inc <- filter(df, Included_an1 == 1)

```

# Demographic Information


```{r demo_data}
#In this chunk I create all objects that will be displayed in my table, my table will have two columns so each object needs to have two numbers 
N_TS <- sum(df_inc$Cond == "TS") #callculate the number of participants in the intervention group
N_ET <- sum(df_inc$Cond == "ET") #callculate the number of participants in the control group

N <- c(sum(df_inc$Cond == "TS"), sum(df_inc$Cond == "ET")) #object 1 - number of all participants 

`Age Median` <- c(median(df_inc$Age[df_inc$Cond == "TS"]), median(df_inc$Age[df_inc$Cond == "ET"])) #object2 - age of participants
`Age Min` <- c(min(df_inc$Age[df_inc$Cond == "TS"]), min(df_inc$Age[df_inc$Cond == "ET"])) #object3 - minimum age 
`Age Max` <- c(max(df_inc$Age[df_inc$Cond == "TS"]), max(df_inc$Age[df_inc$Cond == "ET"])) #object 4 - maximum age

`Male %` <- c((sum(df_inc$Sex[df_inc$Cond == "TS"] == "M")/N_TS)*100, sum((df_inc$Sex[df_inc$Cond == "ET"] == "M")/N_ET)*100) #object5 - percentage of males
`Female %` <- c((sum(df_inc$Sex[df_inc$Cond == "TS"] == "F")/N_TS)*100, sum((df_inc$Sex[df_inc$Cond == "ET"] == "F")/N_ET)*100) #object6 - percentage of females

`Year 0 %` <- c((sum(df_inc$School_year[df_inc$Cond == "TS"] == 0)/N_TS)*100, sum((df_inc$School_year[df_inc$Cond == "ET"] == 0)/N_ET)*100) #boject7 - percentage of children in grade 0
`Year 1 %` <- c((sum(df_inc$School_year[df_inc$Cond == "TS"] == 1)/N_TS)*100, sum((df_inc$School_year[df_inc$Cond == "ET"] == 1)/N_ET)*100) #object8 - percentage of children in grade 1
 
`Bilingual %` <- c((sum(df_inc$Bilingual[df_inc$Cond == "TS"] == 1)/N_TS)*100, sum((df_inc$Bilingual[df_inc$Cond == "ET"] == 1)/N_ET)*100) #object9 - percentage of children who are bilingual

`Right Handed %` <- c((sum(df_inc$Dom_hand[df_inc$Cond == "TS"] == "R")/N_TS)*100, sum((df_inc$Dom_hand[df_inc$Cond == "ET"] == "R")/N_ET)*100) #object10 - percentage of children who are righthanded
`Left Handed %` <- c((sum(df_inc$Dom_hand[df_inc$Cond == "TS"] == "L")/N_TS)*100, sum((df_inc$Dom_hand[df_inc$Cond == "ET"] == "L")/N_ET)*100) #object 11 - percentage of children who are lefthanded

demo <- as.data.frame(rbind(N, `Age Median`, `Age Min`, `Age Max`, `Male %`, `Female %`, `Year 0 %`, `Year 1 %`, `Bilingual %`, `Right Handed %`, `Left Handed %`)) #make a data frame with all of the above objects - it should have 11 rows and two columns

colnames(demo) <- c('Touch Screen', 'Eye Tracker') #add column names 

kable(demo, digits = 0) #make the table and specify how many decimal places should be displayed
```

\newline  
  
**Comments:** There are a couple of issues with the demographics of both groups:  
  
- In the eye-tracker group, most participants are boys  
  
- In the touch-screen group, most participants are from grade 1 and in the eye-tracker group, from grade 0. We have tried to balance this out as well as we could.  
  
Statistical comparisons of intervention data will be adjusted for age using a GLM approach that is consistent with the model that is used to regress out confounds in Fieldtrip.    
  
\newline  
  
# Intervention Details  
Two participants were removed from the RT and DT comparisons because of Touch Screen failure and responses being pressed with the mouse. This led to inaccurate RTs. Thereofre, for RT and DT measures, there are 7 participants in the touch-screen group and 9 participants in the eye-tracker group.  

```{r int_data}
#correct the RT and Acc data 
#Accuracy
regr = df_inc$Age #this is the confound 
dat = df_inc$Train_acc #this is the data that should be corrected
# B = X\Y (beta estimate)
beta = regr / dat 
# Model = X*X\Y
model = regr * beta
# Y clean
Yclean = dat - model

df_inc$Train_acc_cor <- Yclean

#RT
regr = df_inc$Age #this is the confound 
dat = df_inc$Train_corr_RT #this is the data that should be corrected
# B = X\Y (beta estimate)
beta = regr / dat 
# Model = X*X\Y
model = regr * beta
# Y clean
Yclean = dat - model

df_inc$Train_corr_RT_cor <- Yclean

#DT
regr = df_inc$Age #this is the confound 
dat = df_inc$Train_corr_DT #this is the data that should be corrected
# B = X\Y (beta estimate)
beta = regr / dat 
# Model = X*X\Y
model = regr * beta
# Y clean
Yclean = dat - model

df_inc$Train_corr_DT_cor <- Yclean

#select the data for accuracy and rt 
#df_inc_acc <- filter(df_inc, Train_eprime_acc_reliability == "1")
df_inc_acc <- df_inc
df_inc_rt <- filter(df_inc, Train_eprime_rt_reliability == "1")
`Training Accuracy Median` <- c(median(df_inc$Train_acc_cor[df_inc$Cond == "TS"]), median(df_inc$Train_acc_cor[df_inc$Cond == "ET"]))
`Training Accuracy Min` <- c(min(df_inc$Train_acc_cor[df_inc$Cond == "TS"]), min(df_inc$Train_acc_cor[df_inc$Cond == "ET"]))
`Training Accuracy Max` <- c(max(df_inc$Train_acc_cor[df_inc$Cond == "TS"]), max(df_inc$Train_acc_cor[df_inc$Cond == "ET"]))
`Training Correct RT` <- c(median(df_inc$Train_corr_RT_cor[df_inc$Cond == "TS" & df_inc$Train_eprime_rt_reliability == 1]), median(df_inc$Train_corr_RT_cor[df_inc$Cond == "ET"])) 
`Training Correct DT` <- c(median(df_inc$Train_corr_DT_cor[df_inc$Cond == "TS" & df_inc$Train_eprime_rt_reliability == 1]), median(df_inc$Train_corr_DT_cor[df_inc$Cond == "ET"]))

training <- as.data.frame(rbind(`Training Accuracy Median`, `Training Accuracy Min`, `Training Accuracy Max`, `Training Correct RT`, `Training Correct DT`))

colnames(training) <- c('Touch Screen', 'Eye Tracker')

kable(training, digits = 2)
```
  
<br> 
  
#### Intervention Accuracy Comparison  
  
<br> 
  
  
```{r int_acc}
#!!!!!!!!! - Might want to change word to vertical view after knitting the document because the table doesn't fit very well
#Statistics
ttestIS(formula = Train_acc_cor ~ Cond, data = df_inc, mann = TRUE, bf = TRUE, effectSize = TRUE)
```


\newline  
  
```{r int_acc_plot}
pirateplot(formula = Train_acc~Cond, #which variables are you using
           data = df_inc,
           theme = 0, #check out different themes in the guide page linked at the top, theme 0 is starting from scratch
           main = "Intervention Accuracy", #title of the graph
           par(cex.main = 1.2), #set the size of your title
           xlab="Intervention Group", #label of the x axis
           ylab="Accuracy", #label of the y axis
           cex.lab = 1.2, #size of the axis labels
           pal = "basel", # color palette, look at the instruction link to identify different palettes
           inf.method = 'hdi', # method of inference - either High Density Interval (hdi, from Bayesian stats), or standard Confidence Interval (ci)
           bean.f.o = 0.5, # Bean fill darkness
           point.o = .3, # points darkness
           inf.f.o = .5, # Inference fill
           inf.b.o = .5, # Inference border
           avg.line.o = 0.7, # Average line darkness
           inf.f.col = "white", # Inf fill col
           inf.b.col = "black", # Inf border col
           avg.line.col = "black", # avg line col
           point.pch = 20, #point shape
           point.col = "black", #point colour
           point.cex = 1, #point size
           gl.col = "#FFCCFF", #gridlines and colour
           yaxt ="n", # remove the automatic scale on the axis Y
           quant = c(.05, .95) #set the quantile, here within 5% on each side to indicate outliers
           )
axis(2, at = seq(45, 100, by = 10)) #set the numbers on the y axis

```
  
\newline  
  
<br> 
  
#### Intervention Correct Answer Decision Time Comparison  
This is the time from stimulus onset to space bar release.
  
<br> 
  
```{r int_DT}
#Statistics
bayes_rt <- filter(df_inc, Train_eprime_rt_reliability == 1)
ttestIS(formula = Train_corr_DT_cor ~ Cond, data = bayes_rt, mann = TRUE, bf = TRUE, effectSize = TRUE)
```

 
\newline  
  
```{r int_DT_plot}

pirateplot(formula = Train_corr_DT~Cond, #which variables are you using
           data = bayes_rt,
           theme = 0, #check out different themes in the guide page linked at the top, theme 0 is starting from scratch
           main = "Intervention Correct DT", #title of the graph
           par(cex.main = 1.2), #set the size of your title
           xlab="Intervention Group", #label of the x axis
           ylab="DT ms", #label of the y axis
           cex.lab = 1.2, #size of the axis labels
           pal = "basel", # color palette, look at the instruction link to identify different palettes
           inf.method = 'hdi', # method of inference - either High Density Interval (hdi, from Bayesian stats), or standard Confidence Interval (ci)
           bean.f.o = 0.5, # Bean fill darkness
           point.o = .3, # points darkness
           inf.f.o = .5, # Inference fill
           inf.b.o = .5, # Inference border
           avg.line.o = 0.7, # Average line darkness
           inf.f.col = "white", # Inf fill col
           inf.b.col = "black", # Inf border col
           avg.line.col = "black", # avg line col
           point.pch = 20, #point shape
           point.col = "black", #point colour
           point.cex = 1, #point size
           gl.col = "#FFCCFF", #gridlines and colour
           yaxt ="n", # remove the automatic scale on the axis Y
           quant = c(.05, .95) #set the quantile, here within 5% on each side to indicate outliers
           )
axis(2, at = seq(1300, 2900, by = 400)) #set the numbers on the y axis

```
  
\newline  
  

<br> 
  
#### Intervention Correct Answer Reaction Time Comparison  
This is the time from stimulus onset to response.  
  
<br>  
  
```{r int_RT}
#Statistics
ttestIS(formula = Train_corr_RT_cor ~ Cond, data = bayes_rt, mann = TRUE, bf = TRUE, effectSize = TRUE)
```

  
\newline  
  
```{r int_RT_plot}
#got to get rid of the two participants with unreliable data
df_inc_RT <- filter(df_inc, Train_eprime_rt_reliability == 1)

pirateplot(formula = Train_corr_RT~Cond, #which variables are you using
           data = bayes_rt,
           theme = 0, #check out different themes in the guide page linked at the top, theme 0 is starting from scratch
           main = "Intervention Correct RT", #title of the graph
           par(cex.main = 1.2), #set the size of your title
           xlab="Intervention Group", #label of the x axis
           ylab="RT ms", #label of the y axis
           cex.lab = 1.2, #size of the axis labels
           pal = "basel", # color palette, look at the instruction link to identify different palettes
           inf.method = 'hdi', # method of inference - either High Density Interval (hdi, from Bayesian stats), or standard Confidence Interval (ci)
           bean.f.o = 0.5, # Bean fill darkness
           point.o = .3, # points darkness
           inf.f.o = .5, # Inference fill
           inf.b.o = .5, # Inference border
           avg.line.o = 0.7, # Average line darkness
           inf.f.col = "white", # Inf fill col
           inf.b.col = "black", # Inf border col
           avg.line.col = "black", # avg line col
           point.pch = 20, #point shape
           point.col = "black", #point colour
           point.cex = 1, #point size
           gl.col = "#FFCCFF", #gridlines and colour
           yaxt ="n", # remove the automatic scale on the axis Y
           quant = c(.05, .95) #set the quantile, here within 5% on each side to indicate outliers
           )
axis(2, at = seq(1600, 3500, by = 400)) #set the numbers on the y axis

```
  
\newline  
  

  
**Corrected p-values** for accuracy, RT and DT respectively: `r p.adjust(c(0.0209436, 0.0417832, 0.6064685), method = "BH")`
